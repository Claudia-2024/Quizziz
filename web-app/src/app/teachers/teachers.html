<div class="app-container">
  
  <div class="sidebar-container">
    <app-sidebar 
      (sidebarStateChange)="onSidebarStateChange($event)">
    </app-sidebar>
  </div>
  
  <!-- Main content -->
  <div class="main-content-wrapper" [class.collapsed]="isSidebarCollapsed">
   
    <app-navbar 
      [isSidebarCollapsed]="isSidebarCollapsed"
      [pageTitle]="'Teacher Management'"
      [currentUser]="currentUser"
      (logout)="logout()"
      (profileUpdate)="onProfileUpdate($event)">
    </app-navbar>
    
   
    <div class="toast-container" *ngIf="showToast" [class]="'toast-' + toastType">
      <div class="toast-icon">
        <i [class]="toastType === 'success' ? 'fas fa-check-circle' : toastType === 'error' ? 'fas fa-times-circle' : 'fas fa-info-circle'"></i>
      </div>
      <div class="toast-message">{{toastMessage}}</div>
      <button class="toast-close" (click)="hideToast()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <!-- Add Teacher Modal -->
    <div class="modal-overlay" *ngIf="showAddModal">
      <div class="modal-container">
        <div class="modal-header">
          <h2 class="modal-title">Add New Teacher</h2>
          <button class="modal-close" (click)="closeAddModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-row">
            <div class="form-group">
              <label for="firstName">First Name *</label>
              <input type="text" id="firstName" class="form-control" 
                    [(ngModel)]="newTeacher.firstName" 
                    placeholder="e.g., John">
            </div>
            <div class="form-group">
              <label for="lastName">Last Name *</label>
              <input type="text" id="lastName" class="form-control" 
                    [(ngModel)]="newTeacher.lastName" 
                    placeholder="e.g., Doe">
            </div>
          </div>
          
          <div class="form-group">
            <label for="email">Email *</label>
            <input type="email" id="email" class="form-control" 
                  [(ngModel)]="newTeacher.email" 
                  placeholder="e.g., john.doe@university.edu">
          </div>
          
          <div class="form-group">
            <label for="phoneNumber">Phone Number *</label>
            <input type="text" id="phoneNumber" class="form-control" 
                  [(ngModel)]="newTeacher.phoneNumber" 
                  placeholder="e.g., +1234567890">
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeAddModal()">Cancel</button>
          <button class="btn btn-primary" (click)="saveTeacher()">
            <i class="fas fa-save"></i> Save Teacher
          </button>
        </div>
      </div>
    </div>
    
    <!-- Edit Teacher Modal -->
    <div class="modal-overlay" *ngIf="showEditModal">
      <div class="modal-container">
        <div class="modal-header">
          <h2 class="modal-title">Edit Teacher</h2>
          <button class="modal-close" (click)="closeEditModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-row">
            <div class="form-group">
              <label for="editFirstName">First Name *</label>
              <input type="text" id="editFirstName" class="form-control" 
                    [(ngModel)]="editTeacherData.firstName" 
                    placeholder="e.g., John">
            </div>
            <div class="form-group">
              <label for="editLastName">Last Name *</label>
              <input type="text" id="editLastName" class="form-control" 
                    [(ngModel)]="editTeacherData.lastName" 
                    placeholder="e.g., Doe">
            </div>
          </div>
          
          <div class="form-group">
            <label for="editEmail">Email *</label>
            <input type="email" id="editEmail" class="form-control" 
                  [(ngModel)]="editTeacherData.email" 
                  placeholder="e.g., john.doe@university.edu">
          </div>
          
          <div class="form-group">
            <label for="editPhoneNumber">Phone Number *</label>
            <input type="text" id="editPhoneNumber" class="form-control" 
                  [(ngModel)]="editTeacherData.phoneNumber" 
                  placeholder="e.g., +1234567890">
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeEditModal()">Cancel</button>
          <button class="btn btn-primary" (click)="saveEditTeacher()">
            <i class="fas fa-save"></i> Save Changes
          </button>
        </div>
      </div>
    </div>
    
   <!-- Import Modal -->
        <div class="modal-overlay" *ngIf="showImportModal">
          <div class="modal-container">
            <div class="modal-header">
              <h2 class="modal-title">Import Teachers</h2>
              <button class="modal-close" (click)="closeImportModal()" [disabled]="isImporting">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="modal-body">
            
              <div class="form-group">
                <label for="importFile">Select File *</label>
                <div class="file-upload-container">
                  <input type="file" id="importFile" 
                        [accept]="ACCEPTED_FILE_TYPES"
                        (change)="onFileSelected($event)" 
                        [disabled]="isImporting"
                        class="file-input">
                  <label for="importFile" class="file-upload-label">
                    <i class="fas fa-file-upload"></i>
                    <span>{{importFileName || 'Choose CSV or Excel file'}}</span>
                  </label>
                </div>
                <small class="form-text">
                  Supported formats: CSV, XLS, XLSX, XLSM, XLSB, ODS, XLT, XLTX, XLTM, XLAM<br>
                  File must have headers: firstName, lastName, email, phoneNumber. 
                  <a href="javascript:void(0)" (click)="downloadTemplate()" style="color: #331424; text-decoration: underline;">Download Excel template</a>
                </small>
              </div>

              <!-- File info display -->
              <div *ngIf="importFile && fileTypeInfo" class="file-info">
                <div class="file-info-content">
                  <span class="file-icon">
                    {{ fileTypeInfo.type === 'csv' ? 'üìÑ' : 'üìä' }}
                  </span>
                  <div class="file-details">
                    <strong>{{ importFileName }}</strong>
                    <small class="text-muted">
                      {{ fileTypeInfo.type === 'csv' ? 'CSV File' : 'Excel File' }} ‚Ä¢ 
                      {{ (importFile.size / 1024).toFixed(1) }} KB
                    </small>
                  </div>
                </div>
              </div>

              <!-- Preview Section -->
              <div *ngIf="importPreviewData.length > 0" class="preview-section">
                <h4>Preview (first {{importPreviewData.length}} rows)</h4>
                <div class="preview-table">
                  <table>
                    <thead>
                      <tr>
                        <th *ngFor="let header of importHeaders">{{header}}</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let row of importPreviewData">
                        <td *ngFor="let header of importHeaders">{{row[header]}}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              
              <div *ngIf="isImporting" class="progress-section">
                <div class="progress-label">
                  Importing... {{importProgress}}%
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" [style.width.%]="importProgress"></div>
                </div>
              </div>

              
              <div *ngIf="importResult" class="results-section">
                <div [class]="importResult.success ? 'result-success' : 'result-error'">
                  <h4>{{importResult.success ? '‚úÖ Import Successful' : '‚ùå Import Failed'}}</h4>
                  <p>{{importResult.message}}</p>
                  <p><strong>Imported:</strong> {{importResult.importedCount}} | <strong>Failed:</strong> {{importResult.failedCount}}</p>
                  
                  <div *ngIf="importResult.errors && importResult.errors.length > 0" class="error-list">
                    <h5>Errors:</h5>
                    <ul>
                      <li *ngFor="let error of importResult.errors">{{error}}</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary" (click)="closeImportModal()" [disabled]="isImporting">
                Cancel
              </button>
              <button class="btn btn-primary" (click)="executeImport()" 
                      [disabled]="!importFile || isImporting">
                <i class="fas fa-file-import"></i> {{isImporting ? 'Importing...' : 'Import'}}
              </button>
            </div>
          </div>
        </div>
    <!-- Confirmation Modal -->
    <div class="modal-overlay" *ngIf="showConfirmModal">
      <div class="modal-container confirm-modal">
        <div class="modal-header" [class]="'confirm-header-' + confirmModalData.type">
          <h2 class="modal-title">{{confirmModalData.title}}</h2>
          <button class="modal-close" (click)="cancelAction()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body confirm-body">
          <div class="confirm-icon">
            <i [class]="
              confirmModalData.type === 'delete' ? 'fas fa-trash' :
              confirmModalData.type === 'logout' ? 'fas fa-sign-out-alt' :
              'fas fa-info-circle'
            "></i>
          </div>
          <h3 class="confirm-message">{{confirmModalData.message}}</h3>
        </div>
        <div class="modal-footer confirm-footer">
          <button class="btn btn-secondary confirm-cancel" (click)="cancelAction()">
            {{confirmModalData.cancelText}}
          </button>
          <button class="btn confirm-action" 
                  [class]="'confirm-' + confirmModalData.type" 
                  (click)="confirmAction()">
            {{confirmModalData.confirmText}}
          </button>
        </div>
      </div>
    </div>
    
    <main class="main-content">
      <div class="content-container">
        <!--  Actions Header -->
        <div class="table-actions-header">
          <div class="actions-right">
            <button class="action-btn import-btn" (click)="importTable()">
              <i class="fas fa-file-import"></i> Import Teachers
            </button>
            <button class="action-btn add-btn" (click)="openAddModal()">
              <i class="fas fa-plus"></i> Add Teacher
            </button>
            <button class="action-btn export-btn" (click)="exportTable()">
              <i class="fas fa-file-export"></i> Export Teachers
            </button>
          </div>
        </div>

        <!-- Table Container -->
        <div class="table-container">
         
          <div class="table-header">
            <div class="search-container">
              <div class="search-wrapper">
                <i class="fas fa-search search-icon"></i>
                <input type="text" 
                      placeholder="Search teachers..." 
                      class="search-input"
                      [(ngModel)]="searchTerm"
                      (keyup.enter)="onSearch()"
                      (input)="onSearch()">
                <div class="search-hint">
                  <span class="hint-text">Search by name, email, or phone</span>
                </div>
              </div>
            </div>
          </div>

          
         <div class="table-wrapper">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone Number</th>
                    <th>Actions</th> 
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let teacher of paginatedTeachers">
                    <td>{{teacher.fullName}}</td>
                    <td>{{teacher.email}}</td>
                    <td>{{teacher.phoneNumber}}</td>
                    <td>
                      <div class="action-buttons">
                        <button 
                          class="action-btn-text edit-btn" 
                          [title]="'Edit ' + teacher.fullName" 
                          (click)="editTeacher(teacher)">
                          <i class="fas fa-edit"></i> Edit
                        </button>
                        <button 
                          class="action-btn-text delete-btn" 
                          [title]="'Delete ' + teacher.fullName" 
                          (click)="deleteTeacher(teacher)">
                          <i class="fas fa-trash"></i> Delete
                        </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
  

          <!-- Pagination -->
          <div class="pagination-container">
            <div class="pagination-info">
              Showing {{pagination.startIndex}} to {{pagination.endIndex}} of {{pagination.totalItems}} entries
            </div>
            <div class="pagination-controls">
              <button class="pagination-btn" [disabled]="pagination.currentPage === 1" 
                      (click)="goToPage(1)">
                <i class="fas fa-angle-double-left"></i>
              </button>
              <button class="pagination-btn" [disabled]="pagination.currentPage === 1" 
                      (click)="goToPage(pagination.currentPage - 1)">
                <i class="fas fa-chevron-left"></i>
              </button>
              
              <div class="page-numbers">
                <button *ngFor="let page of pagination.pages" 
                        class="page-number" 
                        [class.active]="page === pagination.currentPage"
                        (click)="goToPage(page)">
                  {{page}}
                </button>
              </div>
              
              <button class="pagination-btn" [disabled]="pagination.currentPage === pagination.totalPages" 
                      (click)="goToPage(pagination.currentPage + 1)">
                <i class="fas fa-chevron-right"></i>
              </button>
              <button class="pagination-btn" [disabled]="pagination.currentPage === pagination.totalPages" 
                      (click)="goToPage(pagination.totalPages)">
                <i class="fas fa-angle-double-right"></i>
              </button>
            </div>
            <div class="items-per-page">
              <label for="itemsPerPage">Show:</label>
              <select id="itemsPerPage" [(ngModel)]="pagination.itemsPerPage" (change)="onItemsPerPageChange()">
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="20">20</option>
                <option value="50">50</option>
              </select>
            </div>
          </div>
        </div>
      </div>
      </div>
    </main>
  </div>
</div>