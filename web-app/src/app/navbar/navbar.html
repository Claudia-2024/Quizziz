<nav class="main-navbar" [class.sidebar-collapsed]="isSidebarCollapsed">
  <div class="nav-left">
    <h1 class="page-title">{{ pageTitle }}</h1>
  </div>
  
  <div class="nav-right">
    <!-- Semester Button -->
    <button class="action-btn semester-btn" (click)="openSemesterListModal()">
      <i class="fas fa-calendar-alt"></i>
      <span>Semester</span>
    </button>
    
    <!-- Year Button -->
    <button class="action-btn year-btn" (click)="openYearListModal()">
      <i class="fas fa-calendar"></i>
      <span>Year</span>
    </button>
    
    <!-- Notification section -->
    <div class="notification-container">
      <div class="notification-icon" (click)="toggleNotifications($event)">
        <i class="fas fa-bell"></i>
        <span class="notification-badge">{{unreadNotificationsCount}}</span>
      </div>
      <div class="notification-dropdown" *ngIf="showNotifications" (click)="$event.stopPropagation()">
        <div class="notification-dropdown-header">
          <h3>Notifications</h3>
          <span class="notification-count">{{notifications.length}} total</span>
        </div>
        <div class="notification-list">
          <div *ngFor="let notification of notifications" 
               class="notification-item" 
               [class.unread]="!notification.read">
            <div class="notification-content">
              <div class="notification-title-time">
                <h4>{{notification.title}}</h4>
                <span class="notification-time">{{notification.time}}</span>
              </div>
              <p>{{notification.message}}</p>
            </div>
            <button class="notification-close" (click)="clearNotification(notification, $event)">
              <i class="fas fa-times"></i>
            </button>
          </div>
          
          <div *ngIf="notifications.length === 0" class="no-notifications">
            <i class="fas fa-bell-slash"></i>
            <p>No notifications yet</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- User Profile section -->
    <div class="user-profile-container">
      <div class="user-profile" (click)="toggleUserMenu($event)">
        <div class="user-avatar">
          {{ getInitials(currentUser?.username) }}
        </div>
        <div class="user-info">
          <span class="username">{{currentUser?.username || 'User'}}</span>
        </div>
        <i class="fas fa-chevron-down dropdown-icon"></i>
      </div>
      
      <div class="user-dropdown" *ngIf="showUserMenu" (click)="$event.stopPropagation()">
        <div class="user-dropdown-item" (click)="openProfileModal()">
          <i class="fas fa-user-circle"></i>
          <span>Profile</span>
        </div>
        <div class="user-dropdown-divider"></div>
        <div class="user-dropdown-item logout" (click)="onLogout()">
          <i class="fas fa-sign-out-alt"></i>
          <span>Logout</span>
        </div>
      </div>
    </div>
  </div>
</nav>

<!-- Profile Modal -->
<div class="modal-overlay" *ngIf="showProfileModal">
  <div class="modal-container">
    <div class="modal-header">
      <h2 class="modal-title">User Profile</h2>
      <button class="modal-close" (click)="closeProfileModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <form (ngSubmit)="saveProfile()">
        
        <div class="form-group">
          <label for="username">Username *</label>
          <input type="text" id="username" class="form-control" 
                 [(ngModel)]="updatedUser.username" 
                 name="username"
                 required>
          <small class="form-text">This is your display name</small>
        </div>
        
        <div class="form-group">
          <label for="email">Email Address *</label>
          <input type="email" id="email" class="form-control" 
                 [(ngModel)]="updatedUser.email" 
                 name="email"
                 required>
        </div>
        
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeProfileModal()">Cancel</button>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save"></i> Save Changes
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Semester List Modal -->
<div class="modal-overlay" *ngIf="showSemesterListModal">
  <div class="modal-container large-modal">
    <div class="modal-header">
      <h2 class="modal-title">Semesters</h2>
      <div class="modal-header-actions">
        <button class="btn btn-success" (click)="openAddSemesterModal()">
          <i class="fas fa-plus"></i> Add Semester
        </button>
        <button class="modal-close" (click)="closeSemesterListModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
    <div class="modal-body">
      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>Academic Year</th>
              <th>Semester</th>
              <th>Start Date</th>
              <th>End Date</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let semester of semesters">
              <td>
                <span class="year-badge">
                  {{ getAcademicYearDisplay(semester.yearId) }}
                </span>
              </td>
              <td>{{ getSemesterName(semester.number) }}</td>
              <td>{{ formatDate(semester.startDate) }}</td>
              <td>{{ formatDate(semester.endDate) }}</td>
              <td>
                <span class="status-badge" [class.active]="semester.isActive">
                  {{ semester.isActive ? 'Active' : 'Inactive' }}
                </span>
              </td>
              <td>
                <div class="action-buttons">
                  <button class="btn-edit" (click)="openEditSemesterModal(semester)">
                    <i class="fas fa-edit"></i> Edit
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="semesters.length === 0">
              <td colspan="6" class="no-data">
                <i class="fas fa-calendar-times"></i>
                <p>No semesters found. Click "Add Semester" to create one.</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Year List Modal -->
<div class="modal-overlay" *ngIf="showYearListModal">
  <div class="modal-container large-modal">
    <div class="modal-header">
      <h2 class="modal-title">Academic Years</h2>
      <div class="modal-header-actions">
        <button class="btn btn-success" (click)="openAddYearModal()">
          <i class="fas fa-plus"></i> Add Year
        </button>
        <button class="modal-close" (click)="closeYearListModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
    <div class="modal-body">
      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>Year</th>
              <th>Start Date</th>
              <th>End Date</th>
              <th>Duration</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let year of academicYears">
              <td>
                <strong>{{ formatYearDisplay(year) }}</strong>
              </td>
              <td>{{ formatDate(year.startDate) }}</td>
              <td>{{ formatDate(year.endDate) }}</td>
              <td>{{ calculateDuration(year.startDate, year.endDate) }}</td>
              <td>
                <span class="status-badge" [class.present]="year.isPresent">
                  {{ year.isPresent ? 'Current' : 'Past' }}
                </span>
              </td>
              <td>
                <div class="action-buttons">
                  <button class="btn-edit" (click)="openEditYearModal(year)">
                    <i class="fas fa-edit"></i> Edit
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="academicYears.length === 0">
              <td colspan="6" class="no-data">
                <i class="fas fa-calendar-times"></i>
                <p>No academic years found. Click "Add Year" to create one.</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Add Semester Modal -->
<div class="modal-overlay" *ngIf="showSemesterModal">
  <div class="modal-container">
    <div class="modal-header">
      <h2 class="modal-title">{{ editingSemester ? 'Edit Semester' : 'Add New Semester' }}</h2>
      <button class="modal-close" (click)="closeSemesterModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <form (ngSubmit)="saveSemester()">
        <div class="form-group">
          <label for="academicYear">Academic Year *</label>
          <select id="academicYear" class="form-control" 
                  [(ngModel)]="selectedYearId" 
                  name="academicYear"
                  (change)="onYearChange($event)"
                  required>
            <option value="" disabled selected>Select Academic Year</option>
            <option *ngFor="let year of academicYears" [value]="year.yearId">
              {{ formatYearDisplay(year) }}
            </option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="semesterNumber">Semester Number *</label>
          <div class="input-with-info">
            <input type="number" 
                   id="semesterNumber" 
                   class="form-control" 
                   [(ngModel)]="currentSemester.number" 
                   name="semesterNumber"
                   min="1"
                   max="14"
                   placeholder="Enter semester number (1-14)"
                   required
                   (input)="validateSemesterNumber()">
            <span class="semester-number-indicator">1-14</span>
          </div>
          <small class="form-text">
            Enter semester number between 1 and 14
          </small>
          <div *ngIf="semesterNumberError" class="form-error">
            <i class="fas fa-exclamation-circle"></i> {{ semesterNumberError }}
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="startDate">Start Date *</label>
            <input type="date" id="startDate" class="form-control" 
                   [(ngModel)]="currentSemester.startDate" 
                   name="startDate"
                   required
                   [min]="minStartDate"
                   (change)="validateDates()">
          </div>
          
          <div class="form-group">
            <label for="endDate">End Date *</label>
            <input type="date" id="endDate" class="form-control" 
                   [(ngModel)]="currentSemester.endDate" 
                   name="endDate"
                   required
                   [min]="currentSemester.startDate"
                   (change)="validateDates()">
          </div>
        </div>
        
        <div class="form-group">
          <div class="checkbox-container">
            <input type="checkbox" id="isActive" 
                   [(ngModel)]="currentSemester.isActive" 
                   name="isActive">
            <label for="isActive" class="checkbox-label">
              Set as Active Semester
              <small class="form-text">Only one semester can be active at a time</small>
            </label>
          </div>
        </div>
        
        <div *ngIf="dateError" class="alert alert-danger">
          <i class="fas fa-exclamation-circle"></i> {{ dateError }}
        </div>
        
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeSemesterModal()">Cancel</button>
          <button type="submit" class="btn btn-primary" [disabled]="dateError || semesterNumberError">
            <i class="fas fa-save"></i> {{ editingSemester ? 'Update' : 'Create' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Add Year Modal -->
<div class="modal-overlay" *ngIf="showYearModal">
  <div class="modal-container">
    <div class="modal-header">
      <h2 class="modal-title">{{ editingYear ? 'Edit Academic Year' : 'Add New Academic Year' }}</h2>
      <button class="modal-close" (click)="closeYearModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <form (ngSubmit)="saveYear()">
        <div class="form-row">
          <div class="form-group">
            <label for="yearStartDate">Start Date *</label>
            <input type="date" id="yearStartDate" class="form-control" 
                   [(ngModel)]="currentYear.startDate" 
                   name="yearStartDate"
                   required
                   (change)="validateYearDates()">
          </div>
          
          <div class="form-group">
            <label for="yearEndDate">End Date *</label>
            <input type="date" id="yearEndDate" class="form-control" 
                   [(ngModel)]="currentYear.endDate" 
                   name="yearEndDate"
                   required
                   [min]="currentYear.startDate"
                   (change)="validateYearDates()">
          </div>
        </div>
        
        <div class="form-group">
          <div class="checkbox-container">
            <input type="checkbox" id="isPresent" 
                   [(ngModel)]="currentYear.isPresent" 
                   name="isPresent">
            <label for="isPresent" class="checkbox-label">
              Set as Current Academic Year
              <small class="form-text">Only one academic year can be marked as present</small>
            </label>
          </div>
        </div>
        
        <div *ngIf="yearDateError" class="alert alert-danger">
          <i class="fas fa-exclamation-circle"></i> {{ yearDateError }}
        </div>
        
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeYearModal()">Cancel</button>
          <button type="submit" class="btn btn-primary" [disabled]="yearDateError">
            <i class="fas fa-save"></i> {{ editingYear ? 'Update' : 'Create' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Toast Notifications Container -->
<div class="toast-container">
  <div *ngFor="let toast of toasts" 
       class="toast" 
       [class]="'toast-' + toast.type"
       [class.show]="toast.show">
    <div class="toast-content">
      <div class="toast-message">
        <strong>{{ toast.title }}</strong> - {{ toast.message }}
      </div>
    </div>
    <button class="toast-close" (click)="removeToast(toast.id)">
      <i class="fas fa-times"></i>
    </button>
  </div>
</div>